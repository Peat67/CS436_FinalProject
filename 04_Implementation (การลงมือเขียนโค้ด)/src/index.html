<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BMI Tracker ‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô üìù</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body>
    <header>
        <h1>BMI Tracker ‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô</h1>
    </header>

    <main>
        <section class="input-form">
            <h2>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà</h2>
            
            {% if error %}
                <p class="error-message">‚ö†Ô∏è ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: {{ error }}</p>
            {% endif %}

            <form method="POST">
                <div class="form-group">
                    <label for="date">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</label>
                    <input type="date" id="date" name="date" value="{{ today }}" required>
                </div>
                
                <div class="form-group">
                    <label for="weight_kg">‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å (‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏°):</label>
                    <input type="number" id="weight_kg" name="weight_kg" step="0.1" min="20" max="300" required>
                </div>
                
                <div class="form-group">
                    <label for="height_cm">‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏π‡∏á (‡πÄ‡∏ã‡∏ô‡∏ï‡∏¥‡πÄ‡∏°‡∏ï‡∏£):</label>
                    <input type="number" id="height_cm" name="height_cm" step="0.1" min="50" max="250" required>
                </div>

                <div class="form-group">
                    <button type="submit">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì BMI</button>
                </div>
            </form>
        </section>

        {% if records %}
        <section class="report-graph">
            <h2>üìâ ‡∏Å‡∏£‡∏≤‡∏ü‡πÄ‡∏™‡πâ‡∏ô‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏° BMI</h2>
            <canvas id="bmiChart"></canvas>
        </section>
        {% endif %}

        <section class="report-table">
            <h2>üìã ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì BMI</h2>
            
            {% if records %}
            <table>
                <thead>
                    <tr>
                        <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                        <th>‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å (kg)</th>
                        <th>‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏π‡∏á (cm)</th>
                        <th>BMI</th>
                        <th>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</th>
                    </tr>
                </thead>
                <tbody>
                    {% for record in records %}
                    <tr>
                        <td>{{ record.date }}</td>
                        <td>{{ "{:.1f}".format(record.weight_kg) }}</td>
                        <td>{{ "{:.1f}".format(record.height_m * 100) }}</td> 
                        <td class="bmi-value {{ record.category | lower | replace(' ', '-') }}">
                            <strong>{{ record.bmi }}</strong>
                        </td>
                        <td>{{ record.category }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
                <p class="no-data">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì!</p>
            {% endif %}
        </section>

    </main>

    <script>
        // ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Flask (chart_data)
        const dates = {{ chart_data.dates | tojson }};
        const bmis = {{ chart_data.bmis | tojson }};

        if (dates.length > 0) {
            const ctx = document.getElementById('bmiChart').getContext('2d');
            const bmiChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates, // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏Å‡∏ô X
                    datasets: [{
                        label: '‡∏Ñ‡πà‡∏≤ BMI (Body Mass Index)',
                        data: bmis, // ‡∏Ñ‡πà‡∏≤ BMI ‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏Å‡∏ô Y
                        borderColor: 'rgb(0, 123, 255)', // ‡∏™‡∏µ‡πÄ‡∏™‡πâ‡∏ô
                        backgroundColor: 'rgba(0, 123, 255, 0.1)',
                        tension: 0.4, // ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏™‡πâ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏á‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: false,
                            title: {
                                display: true,
                                text: 'BMI Score'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>